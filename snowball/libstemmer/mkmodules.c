
#include <stdlib.h>
#include <stdio.h>
#include <errno.h>

#ifndef NULL
#define NULL (void *)0
#endif

int main(int argc, char ** argv)
	/*@globals fileSystem @*/
{
    int i;
    int x;
    char * outname;
    FILE * out = stdout;
    char * progname = argv[0];

    if (argc <= 2) {
	fprintf(stderr,
		"Usage: %s <output filename> <language> <language> ...\n",
		progname);
	exit(EXIT_FAILURE);
    }
    outname = argv[1];

    out = fopen(outname, "w");
    if (out == NULL) {
	fprintf(stderr,
		"Can't open output file \"%s\": %s\n",
		outname, strerror(errno));
	exit(EXIT_FAILURE);
    }

    fprintf(out, 
	    "/* %s: List of stemming modules.\n"
	    " *\n"
	    " * This file is generated by mkmodules.c from a list of module names.\n"
	    " * Do not edit manually.\n"
	    " *\n"
	    " * Modules included by this file are: "
	    , outname);
    x = strlen(" * Modules included by this file are: ");
    for (i = 2; i < argc; i++) {
	char * lang = argv[i];
	if (i != 2) {
	    if (x + 2 + strlen(lang) > 77) {
		fprintf(out, ",\n * ");
		x = 3;
	    } else {
		fprintf(out, ", ");
		x += 2;
	    }
	}
	fprintf(out, "%s", lang);
	x += strlen(lang);
    }
    fprintf(out, 
	    "\n */\n\n"
	   );
    for (i = 2; i < argc; i++) {
	char * lang = argv[i];
	fprintf(out, "#include \"../%s/stem.h\"\n", lang);
    }
    fprintf(out, 
	    "\n"
	    "struct stemmer_modules {\n"
	    "  const char * name;\n"
	    "  struct SN_env * (*create)(void);\n"
	    "  void (*close)(struct SN_env *);\n"
	    "  int (*stem)(struct SN_env *);\n"
	    "} modules[] = {\n"
	   );
    for (i = 2; i < argc; i++) {
	char * lang = argv[i];
	fprintf(out, "  {\"%s\", %s_create_env, %s_close_env, %s_stem},\n",
		lang, lang, lang, lang);
    }
    fprintf(out,
	    "  {0,0,0,0}\n"
	    "};\n"
	   );

    if (fclose(out) != 0) {
	fprintf(stderr,
		"Can't close output file \"%s\": %s\n",
		outname, strerror(errno));
	exit(EXIT_FAILURE);
    }


    return 0;
}
